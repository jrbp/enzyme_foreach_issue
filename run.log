Julia: v1.11.3
Project enzyme_test v0.1.0
Status `~/git/temp/enzyme_foreach/Project.toml`
  [b0b7db55] ComponentArrays v0.15.24
  [7da242da] Enzyme v0.13.30
  [37e2e46d] LinearAlgebra v1.11.0
  [9a3f8284] Random v1.11.0
simple run  for    : 0.000000 seconds
simple run  for    : 0.000000 seconds
simple run  foreach: 0.000003 seconds (21 allocations: 336 bytes)
simple run  foreach: 0.000001 seconds (21 allocations: 336 bytes)
simple grad for    : 0.000000 seconds
simple grad for    : 0.000000 seconds
simple grad foreach: 0.165187 seconds (130.66 k allocations: 6.453 MiB, 15.40% gc time, 99.90% compilation time)
simple grad foreach: 0.000026 seconds (98 allocations: 4.656 KiB)
End simple cases
all foreach primal: 3.093468 seconds (8.37 M allocations: 424.118 MiB, 7.00% gc time, 99.98% compilation time)
sum + rest foreach primal: 0.072230 seconds (159.56 k allocations: 8.226 MiB, 99.71% compilation time)
End failing cases
15
16
17
18
19
20
for, primal run
  0.003285 seconds (241 allocations: 10.641 KiB)
  0.003890 seconds (241 allocations: 10.641 KiB)
  0.004538 seconds (241 allocations: 10.641 KiB)
  0.005188 seconds (241 allocations: 10.641 KiB)
  0.005854 seconds (241 allocations: 10.641 KiB)
  0.006641 seconds (241 allocations: 10.641 KiB)
foreach, primal run
  0.004295 seconds (40 allocations: 960 bytes)
  0.005230 seconds (40 allocations: 960 bytes)
  0.006119 seconds (40 allocations: 960 bytes)
  0.007023 seconds (40 allocations: 960 bytes)
  0.008061 seconds (40 allocations: 960 bytes)
  0.008648 seconds (40 allocations: 960 bytes)

for, grad run
  0.050176 seconds (22.41 k allocations: 5.446 MiB)
  0.055386 seconds (23.63 k allocations: 6.008 MiB)
  0.103150 seconds (24.83 k allocations: 6.593 MiB, 36.36% gc time)
foreach, grad run
  0.093974 seconds (123.77 k allocations: 42.986 MiB, 14.97% gc time)
  0.093002 seconds (133.69 k allocations: 51.597 MiB)
  0.381794 seconds (143.69 k allocations: 57.133 MiB, 67.59% gc time)
  0.150216 seconds (153.69 k allocations: 67.276 MiB, 20.70% gc time)
  0.165048 seconds (165.59 k allocations: 76.425 MiB, 15.80% gc time)
  0.193324 seconds (176.40 k allocations: 86.318 MiB, 15.71% gc time)

for, primal comp
  2.355035 seconds (4.76 M allocations: 245.154 MiB, 2.15% gc time, 99.74% compilation time)
  0.479555 seconds (778.31 k allocations: 38.419 MiB, 98.65% compilation time)
  0.497019 seconds (778.32 k allocations: 38.438 MiB, 98.83% compilation time)
  0.467157 seconds (778.36 k allocations: 38.406 MiB, 98.64% compilation time)
  0.477933 seconds (778.32 k allocations: 38.415 MiB, 98.53% compilation time)
  0.500752 seconds (778.37 k allocations: 38.456 MiB, 98.41% compilation time)
foreach, primal comp
  0.994802 seconds (4.57 M allocations: 234.101 MiB, 4.06% gc time, 99.51% compilation time)
  0.283614 seconds (742.65 k allocations: 37.447 MiB, 97.96% compilation time)
  0.283537 seconds (742.67 k allocations: 37.436 MiB, 97.66% compilation time)
  0.270159 seconds (742.69 k allocations: 37.435 MiB, 97.23% compilation time)
  0.270454 seconds (742.71 k allocations: 37.434 MiB, 96.89% compilation time)
  0.235847 seconds (742.71 k allocations: 37.432 MiB, 96.47% compilation time)

note: first gradient comp always takes longer
for, grad comp
 30.221464 seconds (49.99 M allocations: 2.269 GiB, 1.80% gc time, 99.77% compilation time)
  6.567879 seconds (8.71 M allocations: 393.864 MiB, 4.55% gc time, 98.89% compilation time)
  6.355944 seconds (8.71 M allocations: 394.442 MiB, 0.67% gc time, 98.75% compilation time)
foreach, grad comp
 56.713060 seconds (63.35 M allocations: 2.719 GiB, 1.17% gc time, 99.86% compilation time)
 52.967364 seconds (46.18 M allocations: 1.846 GiB, 1.00% gc time, 99.83% compilation time)
 53.499473 seconds (46.19 M allocations: 1.851 GiB, 0.59% gc time, 99.80% compilation time)
 52.085095 seconds (46.81 M allocations: 1.888 GiB, 0.51% gc time, 99.78% compilation time)
 52.553768 seconds (47.73 M allocations: 1.940 GiB, 0.96% gc time, 99.75% compilation time)
 52.498570 seconds (47.74 M allocations: 1.950 GiB, 1.02% gc time, 99.68% compilation time)

